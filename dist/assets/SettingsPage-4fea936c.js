import{s as y,w as o,r as m,V as h,j as e,L as v,y as S}from"./index-ea234c37.js";import{S as b}from"./save-364108a6.js";class w{static async getSystemSettings(){try{const{data:t,error:r}=await y.from("system_settings").select("key, value");if(r)throw r;return(t||[]).reduce((a,u)=>(a[u.key]=u.value,a),{})}catch(t){throw new Error(o(t))}}static async getSetting(t){try{const{data:r,error:a}=await y.from("system_settings").select("value").eq("key",t).single();if(a)throw a;return r==null?void 0:r.value}catch(r){throw new Error(o(r))}}static async updateSetting(t,r,a,u){try{const{data:d,error:l}=await y.from("system_settings").upsert({key:t,value:r,description:a,updated_by:u,updated_at:new Date().toISOString()}).select().single();if(l)throw l;return{success:!0,data:d,message:"تم تحديث الإعداد بنجاح"}}catch(d){return{success:!1,error:o(d)}}}static async getAppSettings(){try{const t=await this.getSystemSettings();return{transport_rates:t.transport_rates||{company_car:.5,taxi:2,uber:1.8,public_transport:.3},working_hours:t.working_hours||{start:"08:00",end:"18:00"},order_number_prefix:t.order_number_prefix||"ORD",company_info:t.company_info||{name:"شركة التنظيف المنزلي",phone:"",address:""}}}catch(t){throw new Error(o(t))}}static async updateTransportRates(t,r){try{return await this.updateSetting("transport_rates",t,"تكلفة المواصلات لكل كيلومتر",r),{success:!0,message:"تم تحديث أسعار المواصلات بنجاح"}}catch(a){return{success:!1,error:o(a)}}}static async updateWorkingHours(t,r){try{return await this.updateSetting("working_hours",t,"ساعات العمل",r),{success:!0,message:"تم تحديث ساعات العمل بنجاح"}}catch(a){return{success:!1,error:o(a)}}}static async updateCompanyInfo(t,r){try{return await this.updateSetting("company_info",t,"معلومات الشركة",r),{success:!0,message:"تم تحديث معلومات الشركة بنجاح"}}catch(a){return{success:!1,error:o(a)}}}static async updateOrderPrefix(t,r){try{return await this.updateSetting("order_number_prefix",t,"بادئة رقم الطلب",r),{success:!0,message:"تم تحديث بادئة رقم الطلب بنجاح"}}catch(a){return{success:!1,error:o(a)}}}}const C=()=>{const[x,t]=m.useState([]),[r,a]=m.useState(!0),[u,d]=m.useState(!1),[l,g]=m.useState({});m.useEffect(()=>{f()},[]);const f=async()=>{try{a(!0);const c=await w.getSystemSettings(),i=Object.entries(c).map(([n,N])=>({id:n,key:n,value:String(N),display_name:n.replace(/_/g," "),description:"",data_type:"string",category:"عام",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));t(i);const s={};i.forEach(n=>{s[n.key]=n.value}),g(s)}catch(c){h.error("حدث خطأ في تحميل الإعدادات"),console.error("Settings fetch error:",c)}finally{a(!1)}},_=async()=>{try{d(!0);const c=Object.entries(l).map(([i,s])=>w.updateSetting(i,s));await Promise.all(c),h.success("تم حفظ الإعدادات بنجاح"),await f()}catch(c){h.error("حدث خطأ في حفظ الإعدادات"),console.error("Settings save error:",c)}finally{d(!1)}},p=(c,i)=>{g(s=>({...s,[c]:i}))},j=x.reduce((c,i)=>{const s=i.category||"عام";return c[s]||(c[s]=[]),c[s].push(i),c},{});return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(v,{size:"large",text:"جاري تحميل الإعدادات..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"إعدادات النظام"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"إدارة إعدادات النظام والتطبيق"})]}),e.jsx("button",{onClick:_,disabled:u,className:"btn-primary",children:u?e.jsx(v,{size:"small"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 ml-2"}),"حفظ الإعدادات"]})})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(j).map(([c,i])=>e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-6 w-6 text-gray-600 ml-2"}),e.jsx("h3",{className:"card-title",children:c})]})}),e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s.display_name||s.key}),s.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),e.jsx("div",{className:"lg:col-span-2",children:s.data_type==="boolean"?e.jsxs("select",{value:l[s.key]||s.value,onChange:n=>p(s.key,n.target.value),className:"input",children:[e.jsx("option",{value:"true",children:"نعم"}),e.jsx("option",{value:"false",children:"لا"})]}):s.data_type==="number"?e.jsx("input",{type:"number",value:l[s.key]||s.value,onChange:n=>p(s.key,n.target.value),className:"input"}):s.data_type==="json"?e.jsx("textarea",{value:l[s.key]||s.value,onChange:n=>p(s.key,n.target.value),className:"input",rows:4,placeholder:"JSON format"}):e.jsx("input",{type:"text",value:l[s.key]||s.value,onChange:n=>p(s.key,n.target.value),className:"input"})})]},s.key))})]},c))}),Object.keys(j).length===0&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد إعدادات متاحة"})]})})]})};export{C as default};
