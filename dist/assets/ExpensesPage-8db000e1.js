import{c as se,s as p,w as j,r as d,V as y,j as e,R as te,X as O,L as G,U as K,S as Q,u as ae}from"./index-ea234c37.js";import{T as re}from"./workers-57d60f20.js";import{O as oe}from"./orders-a172bcdc.js";import{R as ne,a as W}from"./routes-8a3e272c.js";import{T as Y}from"./tag-e5235c04.js";import{C as T}from"./check-circle-6e435bc4.js";import{D as H}from"./dollar-sign-6405c3b9.js";import{F as J}from"./file-text-61c3be99.js";import{C as Z}from"./calendar-0d424678.js";import{S as ce}from"./save-364108a6.js";import{D as le}from"./DeleteConfirmModal-a9e4b9ca.js";import{P as ie,T as de}from"./trash-2-1b0f85d5.js";import{C as me}from"./clock-726c4fbb.js";import{T as ue}from"./trending-up-4ad129ba.js";import{S as xe}from"./search-90baa635.js";import{P as he}from"./pen-square-9a9a872d.js";import{C as pe}from"./check-dd756ef7.js";import{X as ge}from"./x-circle-8e3ae07f.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=se("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=se("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);class q{static async getExpenseCategories(){try{const{data:t,error:n}=await p.from("expense_categories").select("*").eq("is_active",!0).order("name_ar");if(n)throw n;return t||[]}catch(t){throw new Error(j(t))}}static async getExpenses(t,n=1,o=20){var c;try{let a=p.from("expenses").select(`
          *,
          category:expense_categories(*),
          order:orders(order_number, customer:customers(name)),
          route:routes(name),
          team:teams(name),
          created_by_user:users!expenses_created_by_fkey(full_name),
          approved_by_user:users!expenses_approved_by_fkey(full_name)
        `,{count:"exact"}).order("created_at",{ascending:!1});(c=t==null?void 0:t.status)!=null&&c.length&&(a=a.in("status",t.status)),t!=null&&t.category_id&&(a=a.eq("category_id",t.category_id)),t!=null&&t.date_from&&(a=a.gte("created_at",t.date_from)),t!=null&&t.date_to&&(a=a.lte("created_at",t.date_to)),t!=null&&t.team_id&&(a=a.eq("team_id",t.team_id)),t!=null&&t.amount_min&&(a=a.gte("amount",t.amount_min)),t!=null&&t.amount_max&&(a=a.lte("amount",t.amount_max));const l=(n-1)*o,u=l+o-1;a=a.range(l,u);const{data:g,error:f,count:N}=await a;if(f)throw f;return{data:g||[],total:N||0,page:n,limit:o,total_pages:Math.ceil((N||0)/o)}}catch(a){throw new Error(j(a))}}static async getExpenseById(t){try{const{data:n,error:o}=await p.from("expenses").select(`
          *,
          category:expense_categories(*),
          order:orders(
            order_number,
            customer:customers(name)
          ),
          route:routes(name),
          team:teams(name),
          created_by_user:users!expenses_created_by_fkey(full_name),
          approved_by_user:users!expenses_approved_by_fkey(full_name)
        `).eq("id",t).single();if(o)throw o;if(!n)throw new Error("المصروف غير موجود");return n}catch(n){throw new Error(j(n))}}static async createExpense(t){try{const{data:n,error:o}=await p.from("expenses").insert(t).select().single();if(o)throw o;return{success:!0,data:n,message:"تم إضافة المصروف بنجاح"}}catch(n){return{success:!1,error:j(n)}}}static async updateExpense(t,n){try{const{data:o,error:c}=await p.from("expenses").update({...n,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(c)throw c;return{success:!0,data:o,message:"تم تحديث المصروف بنجاح"}}catch(o){return{success:!1,error:j(o)}}}static async approveExpense(t,n){try{const{error:o}=await p.from("expenses").update({status:"approved",approved_by:n,approved_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t);if(o)throw o;return{success:!0,message:"تم الموافقة على المصروف بنجاح"}}catch(o){return{success:!1,error:j(o)}}}static async deleteExpense(t){try{const{error:n}=await p.from("expenses").delete().eq("id",t);if(n)throw n;return{success:!0,message:"تم حذف المصروف بنجاح"}}catch(n){return{success:!1,error:j(n)}}}static async rejectExpense(t,n,o){try{const{error:c}=await p.from("expenses").update({status:"rejected",rejection_reason:n,approved_by:o,approved_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t);if(c)throw c;return{success:!0,message:"تم رفض المصروف"}}catch(c){return{success:!1,error:j(c)}}}static async getPendingExpenses(){try{const{data:t,error:n}=await p.from("expenses").select(`
          *,
          category:expense_categories(*),
          team:teams(name),
          created_by_user:users!expenses_created_by_fkey(full_name)
        `).eq("status","pending").order("created_at");if(n)throw n;return t||[]}catch(t){throw new Error(j(t))}}static async getExpensesByTeam(t,n,o){try{let c=p.from("expenses").select(`
          *,
          category:expense_categories(*),
          order:orders(order_number),
          route:routes(name)
        `).eq("team_id",t).order("created_at",{ascending:!1});n&&(c=c.gte("created_at",n)),o&&(c=c.lte("created_at",o));const{data:a,error:l}=await c;if(l)throw l;return a||[]}catch(c){throw new Error(j(c))}}static async getExpenseStats(t,n){try{let o=p.from("expenses").select("status, amount, category_id, created_at");t&&(o=o.gte("created_at",t)),n&&(o=o.lte("created_at",n));const{data:c,error:a}=await o;if(a)throw a;const l=c||[],u=l.length,g=l.filter(m=>m.status==="approved").length,f=l.filter(m=>m.status==="pending").length,N=l.filter(m=>m.status==="rejected").length,x=l.filter(m=>m.status==="approved").reduce((m,w)=>m+(w.amount||0),0),I=l.reduce((m,w)=>{const _=w.category_id||"other";return m[_]||(m[_]={count:0,amount:0}),m[_].count++,w.status==="approved"&&(m[_].amount+=w.amount||0),m},{});return{total_expenses:u,approved_expenses:g,pending_expenses:f,rejected_expenses:N,total_amount:x,approval_rate:u>0?g/u*100:0,category_stats:I}}catch(o){throw new Error(j(o))}}static async uploadReceiptImage(t,n){try{const o=t.name.split(".").pop(),a=`receipts/${`${n}-${Date.now()}.${o}`}`,{error:l}=await p.storage.from("receipts").upload(a,t);if(l)throw l;const{data:{publicUrl:u}}=p.storage.from("receipts").getPublicUrl(a),{error:g}=await p.from("expenses").update({receipt_image_url:u}).eq("id",n);if(g)throw g;return{success:!0,data:u,message:"تم رفع صورة الإيصال بنجاح"}}catch(o){return{success:!1,error:j(o)}}}}const je=({isOpen:b,onClose:t,onSuccess:n,expense:o,mode:c})=>{const[a,l]=d.useState({category_id:"",amount:0,description:""}),[u,g]=d.useState(new Date().toISOString().split("T")[0]),[f,N]=d.useState(""),[x,I]=d.useState(!1),[m,w]=d.useState(!1),[_,S]=d.useState([]),[C,A]=d.useState([]),[P,M]=d.useState([]),[$,D]=d.useState([]),[v,k]=d.useState({}),[h,B]=d.useState({});d.useEffect(()=>{b&&Promise.all([U(),z(),L(),X()])},[b]),d.useEffect(()=>{o&&c==="edit"?(l({category_id:o.category_id||"",amount:o.amount,description:o.description}),g(o.created_at.split("T")[0]),N(o.receipt_image_url||"")):(l({category_id:"",amount:0,description:""}),g(new Date().toISOString().split("T")[0]),N(""))},[o,c,b]);const U=async()=>{try{w(!0);const r=await q.getExpenseCategories();S(r)}catch(r){y.error("حدث خطأ في تحميل فئات المصروفات"),console.error("Categories fetch error:",r)}finally{w(!1)}},z=async()=>{try{const r=await re.getTeams();A(r)}catch(r){console.error("Teams fetch error",r)}},L=async()=>{try{const r=await oe.getOrders({},1,100);M(r.data)}catch(r){console.error("Orders fetch error",r)}},X=async()=>{try{const r=await ne.getRoutes({},1,100);D(r.data)}catch(r){console.error("Routes fetch error",r)}},F=()=>{const r={};return a.category_id||(r.category_id="فئة المصروف مطلوبة"),a.description.trim()||(r.description="وصف المصروف مطلوب"),a.amount<=0&&(r.amount="يرجى إدخال مبلغ صحيح"),B(r),Object.keys(r).length===0},R=r=>{k(s=>({...s,[r]:!0})),F()},V=async r=>{if(r.preventDefault(),!!F()){I(!0);try{c==="create"?(await q.createExpense({...a,receipt_image_url:f}),y.success("تم إضافة المصروف بنجاح")):(await q.updateExpense(o.id,{...a,receipt_image_url:f}),y.success("تم تحديث بيانات المصروف بنجاح")),n(),t()}catch(s){y.error("حدث خطأ أثناء حفظ البيانات"),console.error("Expense form error:",s)}finally{I(!1)}}};return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform animate-slide-in border border-gray-100",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500 via-red-600 to-orange-600"}),e.jsxs("div",{className:"relative flex items-center justify-between p-6 text-white",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-sm rounded-xl ml-3 shadow-lg border border-white/30",children:e.jsx(te,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:c==="create"?"إضافة مصروف جديد":"تعديل بيانات المصروف"}),e.jsx("p",{className:"text-red-100 text-sm mt-1",children:c==="create"?"تسجيل مصروف جديد":"تحديث بيانات المصروف"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-all duration-200 hover:scale-110 border border-white/30",disabled:x,children:e.jsx(O,{className:"h-5 w-5 text-white"})})]})]}),m?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(G,{size:"medium"})}):e.jsxs("form",{onSubmit:V,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(Y,{className:"h-4 w-4 ml-2 text-red-500"}),"فئة المصروف *"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:a.category_id,onChange:r=>l(s=>({...s,category_id:r.target.value})),onBlur:()=>R("category_id"),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${v.category_id&&h.category_id?"border-red-500 focus:ring-red-500":a.category_id?"border-green-500 focus:ring-green-500":""}`,required:!0,disabled:x,children:[e.jsx("option",{value:"",children:"اختر فئة المصروف"}),_.map(r=>e.jsx("option",{value:r.id,children:r.name_ar},r.id))]}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:v.category_id&&!h.category_id&&a.category_id?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(Y,{className:"h-4 w-4 text-gray-400"})}),v.category_id&&h.category_id&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 animate-bounce-in flex items-center",children:[e.jsx(O,{className:"h-3 w-3 ml-1"}),h.category_id]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(K,{className:"h-4 w-4 ml-2 text-red-500"}),"الفريق (اختياري)"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:a.team_id||"",onChange:r=>l(s=>({...s,team_id:r.target.value||void 0})),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${a.team_id?"border-green-500 focus:ring-green-500":""}`,disabled:x,children:[e.jsx("option",{value:"",children:"اختر الفريق"}),C.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:a.team_id?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(K,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(Q,{className:"h-4 w-4 ml-2 text-red-500"}),"الطلب (اختياري)"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:a.order_id||"",onChange:r=>l(s=>({...s,order_id:r.target.value||void 0})),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${a.order_id?"border-green-500 focus:ring-green-500":""}`,disabled:x,children:[e.jsx("option",{value:"",children:"اختر الطلب"}),P.map(r=>e.jsx("option",{value:r.id,children:r.order_number},r.id))]}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:a.order_id?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(Q,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(W,{className:"h-4 w-4 ml-2 text-red-500"}),"خط السير (اختياري)"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:a.route_id||"",onChange:r=>l(s=>({...s,route_id:r.target.value||void 0})),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${a.route_id?"border-green-500 focus:ring-green-500":""}`,disabled:x,children:[e.jsx("option",{value:"",children:"اختر الخط"}),$.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:a.route_id?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(W,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(H,{className:"h-4 w-4 ml-2 text-red-500"}),"المبلغ (ج.م) *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:a.amount,onChange:r=>l(s=>({...s,amount:Number(r.target.value)})),onBlur:()=>R("amount"),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${v.amount&&h.amount?"border-red-500 focus:ring-red-500":a.amount>0?"border-green-500 focus:ring-green-500":""}`,placeholder:"0.00",min:"0",step:"0.01",required:!0,disabled:x}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:v.amount&&!h.amount&&a.amount>0?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(H,{className:"h-4 w-4 text-gray-400"})}),v.amount&&h.amount&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 animate-bounce-in flex items-center",children:[e.jsx(O,{className:"h-3 w-3 ml-1"}),h.amount]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(J,{className:"h-4 w-4 ml-2 text-red-500"}),"الوصف *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:a.description,onChange:r=>l(s=>({...s,description:r.target.value})),onBlur:()=>R("description"),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 resize-none ${v.description&&h.description?"border-red-500 focus:ring-red-500":a.description.trim()?"border-green-500 focus:ring-green-500":""}`,placeholder:"أدخل وصف المصروف",rows:3,required:!0,disabled:x}),e.jsx("div",{className:"absolute left-3 top-3",children:v.description&&!h.description&&a.description.trim()?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(J,{className:"h-4 w-4 text-gray-400"})}),v.description&&h.description&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 animate-bounce-in flex items-center",children:[e.jsx(O,{className:"h-3 w-3 ml-1"}),h.description]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(Z,{className:"h-4 w-4 ml-2 text-red-500"}),"تاريخ المصروف *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:u,onChange:r=>g(r.target.value),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${u?"border-green-500 focus:ring-green-500":""}`,required:!0,disabled:x}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:u?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(Z,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center label text-gray-700 font-medium",children:[e.jsx(ee,{className:"h-4 w-4 ml-2 text-red-500"}),"رابط صورة الإيصال (اختياري)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"url",value:f,onChange:r=>N(r.target.value),className:`input transition-all duration-200 focus:ring-2 focus:ring-red-500 focus:border-red-500 hover:border-red-300 pl-10 ${f.trim()?"border-green-500 focus:ring-green-500":""}`,placeholder:"https://example.com/receipt.jpg",disabled:x}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:f.trim()?e.jsx(T,{className:"h-4 w-4 text-green-500"}):e.jsx(ee,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse pt-6 border-t border-gray-100",children:[e.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-medium focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 flex items-center",disabled:x,children:[e.jsx(O,{className:"h-4 w-4 ml-2"}),"إلغاء"]}),e.jsx("button",{type:"submit",className:"px-6 py-2.5 bg-gradient-to-r from-red-500 to-orange-600 text-white rounded-lg hover:from-red-600 hover:to-orange-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center",disabled:x,children:x?e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{size:"small"}),e.jsx("span",{className:"mr-2",children:"جاري الحفظ..."})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 ml-2"}),c==="create"?"إضافة المصروف":"حفظ التغييرات"]})})]})]})]})}):null},$e=()=>{var r;const[b,t]=d.useState([]),[n,o]=d.useState(!0),[c,a]=d.useState(""),[l,u]=d.useState({}),[g,f]=d.useState([]),[N,x]=d.useState([]),[I,m]=d.useState(!1),[w,_]=d.useState(!1),[S,C]=d.useState(),[A,P]=d.useState("create"),[M,$]=d.useState(!1),{user:D}=ae();d.useEffect(()=>{v(),k()},[]);const v=async()=>{try{const s=await q.getExpenseCategories();f(s);const i=await re.getTeams();x(i)}catch(s){console.error(s)}},k=async()=>{try{o(!0);const s=await q.getExpenses(l);t(s.data)}catch(s){y.error("حدث خطأ في تحميل المصروفات"),console.error("Expenses fetch error:",s)}finally{o(!1)}},h=async s=>{try{const i=await q.approveExpense(s,(D==null?void 0:D.id)||"");if(!i.success)throw new Error(i.error);y.success("تمت الموافقة على المصروف"),k()}catch(i){y.error("حدث خطأ أثناء الموافقة"),console.error("Approve expense error:",i)}},B=async s=>{const i=window.prompt("أدخل سبب الرفض:");if(i!==null)try{const E=await q.rejectExpense(s,i,(D==null?void 0:D.id)||"");if(!E.success)throw new Error(E.error);y.success("تم رفض المصروف"),k()}catch(E){y.error("حدث خطأ أثناء الرفض"),console.error("Reject expense error:",E)}},U=async()=>{if(S){$(!0);try{const s=await q.deleteExpense(S.id);if(!s.success)throw new Error(s.error);y.success("تم حذف المصروف بنجاح"),_(!1),C(void 0),k()}catch(s){y.error("حدث خطأ أثناء حذف المصروف"),console.error("Delete expense error:",s)}finally{$(!1)}}},z=s=>{const i={pending:"status-pending animate-pulse",approved:"status-approved",rejected:"status-rejected"},E={pending:"معلق",approved:"موافق عليه",rejected:"مرفوض"};return e.jsx("span",{className:`badge ${i[s]||"badge-gray"}`,children:E[s]||s})},L=b.filter(s=>{var i;return s.description.toLowerCase().includes(c.toLowerCase())||((i=s.category)==null?void 0:i.name.toLowerCase().includes(c.toLowerCase()))});if(n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"large",text:"جاري تحميل المصروفات..."})});const X=b.length,F=b.reduce((s,i)=>s+i.amount,0),R=b.filter(s=>s.status==="pending").length,V=b.filter(s=>s.status==="approved").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"إدارة المصروفات"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"إدارة مصروفات الشركة والموافقة عليها"})]}),e.jsxs("button",{onClick:()=>{C(void 0),P("create"),m(!0)},className:"btn-primary hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl",children:[e.jsx(ie,{className:"h-5 w-5 ml-2"}),"إضافة مصروف جديد"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"card-compact bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"إجمالي المصروفات"}),e.jsx("p",{className:"text-2xl font-bold",children:X})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx(J,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"card-compact bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"إجمالي المبلغ"}),e.jsxs("p",{className:"text-2xl font-bold",children:[F.toLocaleString()," ج.م"]})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx(H,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"card-compact bg-gradient-to-br from-yellow-500 to-orange-500 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"في الانتظار"}),e.jsx("p",{className:"text-2xl font-bold",children:R})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx(me,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"card-compact bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"موافق عليها"}),e.jsx("p",{className:"text-2xl font-bold",children:V})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx(ue,{className:"h-6 w-6"})})]})})]}),e.jsxs("div",{className:"card-compact",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"text-gray-500"}),e.jsxs("select",{value:l.category_id||"",onChange:s=>u(i=>({...i,category_id:s.target.value||void 0})),className:"input-field focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all",children:[e.jsx("option",{value:"",children:"كل الفئات"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name_ar},s.id))]})]}),e.jsx("div",{children:e.jsxs("select",{value:l.team_id||"",onChange:s=>u(i=>({...i,team_id:s.target.value||void 0})),className:"input-field focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all",children:[e.jsx("option",{value:"",children:"كل الفرق"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:((r=l.status)==null?void 0:r[0])||"",onChange:s=>u(i=>({...i,status:s.target.value?[s.target.value]:void 0})),className:"input-field focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all",children:[e.jsx("option",{value:"",children:"كل الحالات"}),e.jsx("option",{value:"pending",children:"معلق"}),e.jsx("option",{value:"approved",children:"موافق"}),e.jsx("option",{value:"rejected",children:"مرفوض"})]})}),e.jsx("div",{children:e.jsx("button",{onClick:k,className:"btn-secondary hover:scale-105 transition-all duration-200",children:"تصفية"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"البحث في المصروفات...",className:"input pr-10 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all",value:c,onChange:s=>a(s.target.value)})]}),c&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["تم العثور على ",L.length,' نتيجة للبحث عن "',c,'"']})})]}),e.jsx("div",{className:"card-elevated",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell",children:"الوصف"}),e.jsx("th",{className:"table-header-cell",children:"الفئة"}),e.jsx("th",{className:"table-header-cell",children:"المبلغ"}),e.jsx("th",{className:"table-header-cell",children:"التاريخ"}),e.jsx("th",{className:"table-header-cell",children:"الحالة"}),e.jsx("th",{className:"table-header-cell",children:"المُدخل بواسطة"}),e.jsx("th",{className:"table-header-cell",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"table-body",children:L.map(s=>{var i,E;return e.jsxs("tr",{className:"table-row",children:[e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400 ml-2"}),e.jsx("span",{className:"font-medium",children:s.description})]})}),e.jsx("td",{className:"table-cell",children:(i=s.category)==null?void 0:i.name}),e.jsxs("td",{className:"table-cell font-semibold",children:[s.amount," ج.م"]}),e.jsx("td",{className:"table-cell",children:new Date(s.created_at).toLocaleDateString("ar-AE")}),e.jsx("td",{className:"table-cell",children:z(s.status)}),e.jsx("td",{className:"table-cell",children:((E=s.created_by_user)==null?void 0:E.full_name)||"غير محدد"}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("button",{onClick:()=>{C(s),P("edit"),m(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all hover:scale-110 shadow-sm hover:shadow-md",title:"تعديل",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{C(s),_(!0)},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all hover:scale-110 shadow-sm hover:shadow-md",title:"حذف",children:e.jsx(de,{className:"h-4 w-4"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(s.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-all hover:scale-110 shadow-sm hover:shadow-md",title:"موافقة",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>B(s.id),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all hover:scale-110 shadow-sm hover:shadow-md",title:"رفض",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})})]},s.id)})})]}),L.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"لا توجد مصروفات مطابقة للبحث"})})]})}),e.jsx(je,{isOpen:I,onClose:()=>{m(!1),C(void 0)},onSuccess:()=>{k()},expense:S,mode:A}),e.jsx(le,{isOpen:w,onClose:()=>{_(!1),C(void 0)},onConfirm:U,title:"حذف المصروف",message:"هل أنت متأكد من رغبتك في حذف هذا المصروف؟ لا يمكن التراجع عن هذا الإجراء.",itemName:S==null?void 0:S.description,loading:M})]})};export{$e as default};
